---
/**
 * HeroMentor - "Technology Mentor" slide
 * Beige background (#f5f0e6) with graduation cap and cursor decorations
 * Features GSAP text reveal animation
 */
import GraduationCap from '@/components/icons/GraduationCap.astro';
import Cursor from '@/components/icons/Cursor.astro';
---

<section
  id="slide-mentor"
  class="hero-slide absolute inset-0 bg-slide-beige overflow-hidden"
  data-slide="2"
  data-active="false"
>
  <!-- Graduation Cap Decoration (left side) -->
  <div class="graduation-cap-decoration absolute top-[28%] left-[8%] md:left-[12%] lg:left-[15%] pointer-events-none opacity-0">
    <GraduationCap size={100} class="w-[120px] h-[70px] md:w-[180px] md:h-[105px] lg:w-[220px] lg:h-[128px]" />
  </div>

  <!-- Cursor Decoration (right side) -->
  <div class="cursor-decoration absolute bottom-[25%] right-[10%] md:right-[15%] lg:right-[18%] pointer-events-none opacity-0">
    <Cursor size={70} class="w-[45px] h-[60px] md:w-[55px] md:h-[75px] lg:w-[67px] lg:h-[90px]" />
  </div>

  <!-- Cross Decorations -->
  <div class="cross-decoration-mentor-1 absolute top-[40%] right-[25%] rotate-45 pointer-events-none hidden lg:block opacity-0">
    <svg width="36" height="36" viewBox="0 0 36 36" fill="none">
      <path d="M18 0V36M0 18H36" stroke="#413fd9" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </div>

  <div class="cross-decoration-mentor-2 absolute bottom-[35%] left-[22%] rotate-12 pointer-events-none hidden lg:block opacity-0">
    <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
      <path d="M14 0V28M0 14H28" stroke="#eeb700" stroke-width="2.5" stroke-linecap="round"/>
    </svg>
  </div>

  <!-- Accent elements -->
  <div class="accent-circle absolute top-[20%] right-[30%] w-4 h-4 rounded-full bg-accent-purple opacity-0 hidden md:block"></div>
  <div class="accent-circle absolute bottom-[45%] left-[28%] w-2.5 h-2.5 rounded-full bg-accent-yellow opacity-0 hidden md:block"></div>

  <!-- Main Content -->
  <div class="relative z-10 flex flex-col items-center justify-center h-full px-6 pt-16 md:pt-20">
    <!-- Title with text reveal animation -->
    <div class="text-center overflow-hidden">
      <h2 class="hero-title font-display text-brand-brown leading-[1] md:leading-[1.1]">
        <span class="title-line block overflow-hidden">
          <span class="title-text-mentor inline-block text-[clamp(2rem,7vw,6rem)]">Technology</span>
        </span>
        <span class="title-line block overflow-hidden">
          <span class="title-text-mentor inline-block text-[clamp(2rem,7vw,6rem)]">Mentor</span>
        </span>
      </h2>
    </div>

    <!-- Subtitle -->
    <p class="hero-subtitle subtitle-mentor mt-6 md:mt-10 text-brand-dark text-center text-base md:text-xl leading-[1.4] max-w-[320px] md:max-w-[666px] font-sans opacity-0">
      Guiding the next generation of developers through hands-on teaching and personalized mentorship.
    </p>
  </div>

  <!-- Background text hints (sides, faded) -->
  <div
    class="bg-text-left hidden xl:block absolute top-1/2 -translate-y-1/2 left-[-280px] text-brand-brown/15 font-display text-[100px] 2xl:text-[128px] leading-[1.1] text-center whitespace-nowrap pointer-events-none select-none"
    aria-hidden="true"
  >
    <p>Oh boy, can</p>
    <p>I code</p>
  </div>

  <div
    class="bg-text-right hidden xl:block absolute top-1/2 -translate-y-1/2 right-[-280px] text-brand-brown/15 font-display text-[100px] 2xl:text-[128px] leading-[1.1] text-center whitespace-nowrap pointer-events-none select-none"
    aria-hidden="true"
  >
    <p>Hi! I'm</p>
    <p>Tania Tello</p>
  </div>
</section>

<style>
  .hero-slide {
    transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
  }

  .hero-slide[data-active="false"] {
    opacity: 0;
    pointer-events: none;
  }

  .hero-slide[data-active="true"] {
    opacity: 1;
    pointer-events: auto;
  }

  /* Initial state for animations */
  .title-text-mentor {
    transform: translateY(100%);
  }
</style>

<script>
  import gsap from 'gsap';

  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  function initHeroMentorAnimations() {
    const slide = document.getElementById('slide-mentor');
    if (!slide || slide.dataset.active !== 'true') return;

    const ctx = gsap.context(() => {
      if (prefersReducedMotion) {
        gsap.set('.title-text-mentor', { y: 0 });
        gsap.set('.subtitle-mentor', { opacity: 1 });
        gsap.set('.graduation-cap-decoration, .cursor-decoration', { opacity: 1 });
        gsap.set('.cross-decoration-mentor-1, .cross-decoration-mentor-2, .accent-circle', { opacity: 1 });
        return;
      }

      const tl = gsap.timeline({ defaults: { ease: 'power3.out' } });

      // Text reveal animation
      tl.to('.title-text-mentor', {
        y: 0,
        duration: 1,
        stagger: 0.15,
        ease: 'power3.out'
      })

      // Subtitle fade in
      .to('.subtitle-mentor', {
        opacity: 1,
        y: 0,
        duration: 0.8,
        ease: 'power2.out'
      }, '-=0.4')

      // Graduation cap entrance (from left)
      .to('.graduation-cap-decoration', {
        opacity: 1,
        x: 0,
        duration: 0.8,
        ease: 'back.out(1.4)'
      }, '-=0.5')

      // Cursor entrance (from right)
      .to('.cursor-decoration', {
        opacity: 1,
        x: 0,
        duration: 0.7,
        ease: 'back.out(1.4)'
      }, '-=0.5')

      // Cross decorations
      .to('.cross-decoration-mentor-1', {
        opacity: 1,
        scale: 1,
        rotation: 45,
        duration: 0.5,
        ease: 'back.out(1.7)'
      }, '-=0.3')

      .to('.cross-decoration-mentor-2', {
        opacity: 1,
        scale: 1,
        duration: 0.5,
        ease: 'back.out(1.7)'
      }, '-=0.2')

      // Accent circles
      .to('.accent-circle', {
        opacity: 0.8,
        scale: 1,
        duration: 0.4,
        stagger: 0.1,
        ease: 'power2.out'
      }, '-=0.3');

      // Floating animation for graduation cap
      gsap.to('.graduation-cap-decoration', {
        y: -12,
        rotation: -3,
        duration: 3,
        repeat: -1,
        yoyo: true,
        ease: 'sine.inOut'
      });

      // Floating animation for cursor
      gsap.to('.cursor-decoration', {
        y: -8,
        rotation: 5,
        duration: 2.5,
        repeat: -1,
        yoyo: true,
        ease: 'sine.inOut',
        delay: 0.5
      });

      // Cross decoration floating
      gsap.to('.cross-decoration-mentor-1', {
        y: -6,
        duration: 2.8,
        repeat: -1,
        yoyo: true,
        ease: 'sine.inOut'
      });

      gsap.to('.cross-decoration-mentor-2', {
        y: -5,
        duration: 2.2,
        repeat: -1,
        yoyo: true,
        ease: 'sine.inOut',
        delay: 0.8
      });

    }, slide);

    return ctx;
  }

  // Initialize on DOM ready if slide is active
  document.addEventListener('DOMContentLoaded', () => {
    const slide = document.getElementById('slide-mentor');
    if (slide?.dataset.active === 'true') {
      initHeroMentorAnimations();
    }
  });

  // Re-run animations when slide becomes active
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'data-active') {
        const slide = mutation.target as HTMLElement;
        if (slide.dataset.active === 'true') {
          // Reset animations
          gsap.set('.title-text-mentor', { y: '100%' });
          gsap.set('.subtitle-mentor', { opacity: 0 });
          gsap.set('.graduation-cap-decoration', { opacity: 0, x: -30 });
          gsap.set('.cursor-decoration', { opacity: 0, x: 30 });
          gsap.set('.cross-decoration-mentor-1, .cross-decoration-mentor-2', { opacity: 0, scale: 0 });
          gsap.set('.accent-circle', { opacity: 0, scale: 0 });
          initHeroMentorAnimations();
        }
      }
    });
  });

  const slideMentor = document.getElementById('slide-mentor');
  if (slideMentor) {
    observer.observe(slideMentor, { attributes: true });
  }
</script>
