---
/**
 * HeroRole - "Sr. Front End Engineer" slide
 * Blue background (#e0f4f5) with React logo decoration
 * Features GSAP text reveal animation
 */
import ReactLogo from '@/components/icons/ReactLogo.astro';
---

<section
  id="slide-role"
  class="hero-slide absolute inset-0 bg-slide-blue overflow-hidden"
  data-slide="1"
  data-active="false"
>
  <!-- React Logo Decoration (centered, behind text) -->
  <div class="react-logo-decoration absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0">
    <ReactLogo size={400} class="w-[250px] h-[220px] md:w-[350px] md:h-[310px] lg:w-[450px] lg:h-[400px]" />
  </div>

  <!-- Cross Decorations -->
  <div class="cross-decoration-1 absolute top-[25%] left-[15%] rotate-45 pointer-events-none hidden lg:block opacity-0">
    <svg width="44" height="44" viewBox="0 0 44 44" fill="none">
      <path d="M22 0V44M0 22H44" stroke="#61dafb" stroke-width="2.5" stroke-linecap="round"/>
    </svg>
  </div>

  <div class="cross-decoration-2 absolute bottom-[30%] right-[12%] rotate-12 pointer-events-none hidden lg:block opacity-0">
    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
      <path d="M16 0V32M0 16H32" stroke="#673437" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </div>

  <!-- Small accent dots -->
  <div class="accent-dot absolute top-[35%] right-[20%] w-3 h-3 rounded-full bg-accent-blue opacity-0 hidden md:block"></div>
  <div class="accent-dot absolute bottom-[40%] left-[18%] w-2 h-2 rounded-full bg-brand-brown opacity-0 hidden md:block"></div>

  <!-- Main Content -->
  <div class="relative z-10 flex flex-col items-center justify-center h-full px-6 pt-16 md:pt-20">
    <!-- Title with text reveal animation -->
    <div class="text-center overflow-hidden">
      <h2 class="hero-title font-display text-brand-brown leading-[1] md:leading-[1.1]">
        <span class="title-line block overflow-hidden">
          <span class="title-text-role inline-block text-[clamp(2rem,7vw,6rem)]">Sr. Front End</span>
        </span>
        <span class="title-line block overflow-hidden">
          <span class="title-text-role inline-block text-[clamp(2rem,7vw,6rem)]">Engineer</span>
        </span>
      </h2>
    </div>

    <!-- Subtitle -->
    <p class="hero-subtitle subtitle-role mt-6 md:mt-10 text-brand-dark text-center text-base md:text-xl leading-[1.4] max-w-[320px] md:max-w-[666px] font-sans opacity-0">
      Building beautiful, performant, and accessible web experiences with modern technologies.
    </p>
  </div>

  <!-- Background text hints (sides, faded) -->
  <div
    class="bg-text-left hidden xl:block absolute top-1/2 -translate-y-1/2 left-[-280px] text-brand-brown/15 font-display text-[100px] 2xl:text-[128px] leading-[1.1] text-center whitespace-nowrap pointer-events-none select-none"
    aria-hidden="true"
  >
    <p>Technology</p>
    <p>Mentor</p>
  </div>

  <div
    class="bg-text-right hidden xl:block absolute top-1/2 -translate-y-1/2 right-[-280px] text-brand-brown/15 font-display text-[100px] 2xl:text-[128px] leading-[1.1] text-center whitespace-nowrap pointer-events-none select-none"
    aria-hidden="true"
  >
    <p>Oh boy, can</p>
    <p>I code</p>
  </div>
</section>

<style>
  .hero-slide {
    transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
  }

  .hero-slide[data-active="false"] {
    opacity: 0;
    pointer-events: none;
  }

  .hero-slide[data-active="true"] {
    opacity: 1;
    pointer-events: auto;
  }

  /* Initial state for animations */
  .title-text-role {
    transform: translateY(100%);
  }
</style>

<script>
  import gsap from 'gsap';

  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  function initHeroRoleAnimations() {
    const slide = document.getElementById('slide-role');
    if (!slide || slide.dataset.active !== 'true') return;

    const ctx = gsap.context(() => {
      if (prefersReducedMotion) {
        gsap.set('.title-text-role', { y: 0 });
        gsap.set('.subtitle-role', { opacity: 1 });
        gsap.set('.react-logo-decoration', { opacity: 0.15 });
        gsap.set('.cross-decoration-1, .cross-decoration-2, .accent-dot', { opacity: 1 });
        return;
      }

      const tl = gsap.timeline({ defaults: { ease: 'power3.out' } });

      // React logo fade in first (background)
      tl.to('.react-logo-decoration', {
        opacity: 0.15,
        scale: 1,
        duration: 1,
        ease: 'power2.out'
      })

      // Text reveal animation
      .to('.title-text-role', {
        y: 0,
        duration: 1,
        stagger: 0.15,
        ease: 'power3.out'
      }, '-=0.6')

      // Subtitle fade in
      .to('.subtitle-role', {
        opacity: 1,
        y: 0,
        duration: 0.8,
        ease: 'power2.out'
      }, '-=0.4')

      // Cross decorations
      .to('.cross-decoration-1', {
        opacity: 1,
        scale: 1,
        rotation: 45,
        duration: 0.6,
        ease: 'back.out(1.7)'
      }, '-=0.3')

      .to('.cross-decoration-2', {
        opacity: 1,
        scale: 1,
        duration: 0.5,
        ease: 'back.out(1.7)'
      }, '-=0.2')

      // Accent dots
      .to('.accent-dot', {
        opacity: 0.8,
        scale: 1,
        duration: 0.4,
        stagger: 0.1,
        ease: 'power2.out'
      }, '-=0.3');

      // Continuous subtle rotation for React logo
      gsap.to('.react-logo-decoration', {
        rotation: 360,
        duration: 60,
        repeat: -1,
        ease: 'none'
      });

      // Floating animation for cross decorations
      gsap.to('.cross-decoration-1', {
        y: -8,
        duration: 3,
        repeat: -1,
        yoyo: true,
        ease: 'sine.inOut'
      });

      gsap.to('.cross-decoration-2', {
        y: -6,
        duration: 2.5,
        repeat: -1,
        yoyo: true,
        ease: 'sine.inOut',
        delay: 0.5
      });

    }, slide);

    return ctx;
  }

  // Initialize on DOM ready if slide is active
  document.addEventListener('DOMContentLoaded', () => {
    const slide = document.getElementById('slide-role');
    if (slide?.dataset.active === 'true') {
      initHeroRoleAnimations();
    }
  });

  // Re-run animations when slide becomes active
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'data-active') {
        const slide = mutation.target as HTMLElement;
        if (slide.dataset.active === 'true') {
          // Reset animations
          gsap.set('.title-text-role', { y: '100%' });
          gsap.set('.subtitle-role', { opacity: 0 });
          gsap.set('.react-logo-decoration', { opacity: 0, scale: 0.8 });
          gsap.set('.cross-decoration-1, .cross-decoration-2', { opacity: 0, scale: 0 });
          gsap.set('.accent-dot', { opacity: 0, scale: 0 });
          initHeroRoleAnimations();
        }
      }
    });
  });

  const slideRole = document.getElementById('slide-role');
  if (slideRole) {
    observer.observe(slideRole, { attributes: true });
  }
</script>
