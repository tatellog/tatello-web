---
import PenguinWaving from '@/components/icons/PenguinWaving.astro';
import StarDecoration from '@/components/ui/StarDecoration.astro';
import CircleDecoration from '@/components/ui/CircleDecoration.astro';
import XDecoration from '@/components/ui/XDecoration.astro';
import PlusDecoration from '@/components/ui/PlusDecoration.astro';
import ScrollIndicator from '@/components/ui/ScrollIndicator.astro';
import BrainDiagram from '@/components/icons/BrainDiagram.astro';

interface Props {
  title?: string;
  sectionLabel?: string;
  description?: string;
}

const {
  title = "'Sup, I'm Tania Tello",
  sectionLabel = 'about me',
  description = "I'm a 7+ year of experience Front End Engineer. I craft dynamic web apps, e-commerce sites, and mobile apps. Eager to learn, tech advocate, and women's mentor for inclusive tech growth."
} = Astro.props;
---

<section
  id="about-hero"
  class="about-hero relative w-full"
  style="background-color: #FADCDE; border-radius: 16px 16px 0px 0px;"
>
  <!-- Pinned container -->
  <div class="about-pin-container h-screen w-full overflow-hidden relative" style="overflow: hidden;">
    <!-- Background decorations -->
    <div class="absolute inset-0 pointer-events-none">
      <!-- Bottom left cream circle -->
      <CircleDecoration
        class="circle-bottom-left absolute -bottom-[100px] -left-[150px] lg:-bottom-[150px] lg:-left-[200px] !w-[450px] !h-[450px] lg:!w-[650px] lg:!h-[650px]"
        size="xl"
        color="cream"
        opacity={0.7}
      />

      <!-- Bottom right cream circle -->
      <CircleDecoration
        class="circle-bottom-right absolute -bottom-24 -right-24 lg:-bottom-32 lg:-right-32"
        size="xl"
        color="cream"
        opacity={0.7}
      />

      <!-- Star decorations on left -->
      <div class="stars-left absolute left-[3%] lg:left-[6%] top-[38%] lg:top-[42%]">
        <StarDecoration size="sm" color="pink" class="star-float absolute -top-8 left-4" />
        <StarDecoration size="lg" color="pink" class="star-float" />
        <StarDecoration size="md" color="pink" class="star-float-delay absolute top-6 left-10" />
        <StarDecoration size="md" color="pink" class="star-float absolute top-14 -left-2" />
        <StarDecoration size="sm" color="pink" class="star-float-delay absolute top-20 left-8" />
      </div>

      <!-- Star decorations on right -->
      <div class="stars-right absolute right-[5%] lg:right-[8%] top-[35%] lg:top-[40%]">
        <StarDecoration size="sm" color="pink" class="star-float absolute -top-4 right-2" />
        <StarDecoration size="md" color="pink" class="star-float-delay" />
        <StarDecoration size="sm" color="pink" class="star-float absolute top-8 right-6" />
      </div>
    </div>

    <!-- Main content -->
    <div class="relative z-10 h-full w-full flex flex-col items-center justify-center">
      <!-- White/pink circle behind penguin (hidden initially) -->
      <div class="penguin-bg-circle absolute top-[18%] left-1/2 -translate-x-1/2 rounded-full bg-[#F8E8EA] w-[220px] h-[220px] md:w-[320px] md:h-[320px] lg:w-[400px] lg:h-[400px]"></div>

      <!-- Penguin (centered, starts smaller) -->
      <div class="penguin-wrapper absolute top-[28%] left-1/2 -translate-x-1/2">
        <PenguinWaving width={333} height={248} class="penguin-img w-[200px] h-auto md:w-[280px] lg:w-[333px]" />
      </div>

      <!-- Title (starts TOP-RIGHT, moves DIAGONALLY to CENTER) -->
      <h1
        class="hero-title absolute whitespace-nowrap text-brand-brown text-center"
        style="font-family: 'Stacion', serif; font-weight: 400; font-size: clamp(36px, 10vw, 120px); line-height: 25px; letter-spacing: 0px;"
      >
        {title}
      </h1>

      <!-- X decoration before title (hidden initially) -->
      <XDecoration class="x-before-title absolute top-[54%] left-[8%] lg:left-[12%]" size="xl" color="coral" />

      <!-- Description (hidden initially, appears below title) -->
      <div
        class="hero-description absolute top-[66%] left-1/2 -translate-x-1/2 text-brand-brown/80 text-center max-w-[300px] md:max-w-lg lg:max-w-xl"
        style="font-family: 'GT Planar', sans-serif; font-weight: 400; font-size: 20px; line-height: 130%; letter-spacing: 0px;"
      >
        <p>{description}</p>
      </div>

      <!-- X decoration on bottom right (hidden initially) -->
      <XDecoration class="x-decoration-right absolute top-[82%] right-[25%] lg:right-[30%]" size="xl" color="coral" />

      <!-- Scroll indicator -->
      <div class="scroll-indicator absolute bottom-12 left-1/2 -translate-x-1/2">
        <ScrollIndicator />
      </div>

      <!-- Brain state (state 3) - hidden initially -->
      <div class="brain-container absolute top-[-15%] inset-x-0 flex justify-center">
        <BrainDiagram class="brain-diagram w-[90%] md:w-[70%] lg:w-[50%] max-w-[700px]" />
      </div>

      <!-- Brain state decorations (hidden initially) -->
      <PlusDecoration class="brain-plus-left absolute left-[8%] top-[55%]" size="lg" color="coral" />
      <XDecoration class="brain-x-right absolute right-[10%] top-[30%]" size="lg" color="coral" />

    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (!prefersReducedMotion) {

    gsap.set('.hero-title', { top: '15%', right: '5%', left: 'auto', x: '0%' });
    gsap.set('.penguin-wrapper', { scale: 1 });
    gsap.set('.penguin-bg-circle', { opacity: 1, scale: 0.6, left: '70%', top: '25%' });
    gsap.set('.hero-description', { opacity: 0, y: 30 });
    gsap.set('.x-before-title', { opacity: 0 });
    gsap.set('.x-decoration-right', { opacity: 0 });

    // Círculos crema - estado inicial
    gsap.set('.circle-bottom-left', { y: '15%', scale: 0.7 });
    gsap.set('.circle-bottom-right', { y: '-20%', x: '15%' });

    // Brain state - hidden initially
    gsap.set('.brain-container', { opacity: 0, scale: 0.8 });
    gsap.set('.brain-plus-left', { opacity: 0 });
    gsap.set('.brain-x-right', { opacity: 0 });

    // Entrance animation
    const entranceTl = gsap.timeline({ defaults: { ease: 'power3.out' } });
    entranceTl
      .from('.hero-title', { opacity: 0, x: 30, duration: 1, delay: 0.2 })
      .from('.penguin-bg-circle', { opacity: 0, scale: 0.4, duration: 0.8 }, '-=0.7')
      .from('.penguin-wrapper', { opacity: 0, y: 40, duration: 0.8 }, '-=0.5');

    // ============================================
    // PARALLAX SCROLL ANIMATION
    // ============================================
    const mainTl = gsap.timeline({
      scrollTrigger: {
        trigger: '#about-hero',
        start: 'top top',
        end: '+=250%',
        pin: '.about-pin-container',
        scrub: 1,
        anticipatePin: 1,
        // markers: true,
      }
    });

    // --- 0% to 50% scroll ---

    // Title moves DIAGONALLY from TOP-RIGHT to CENTER
    mainTl.to('.hero-title', {
      top: '52%',
      left: '50%',
      x: '-50%',
      duration: 0.5,
      ease: 'none'
    }, 0);

    // Penguin grows to full size
    mainTl.to('.penguin-wrapper', {
      scale: 1,
      duration: 0.5,
      ease: 'none'
    }, 0);

    // Circle moves from right to center (behind penguin) and grows
    mainTl.to('.penguin-bg-circle', {
      left: '50%',
      top: '18%',
      scale: 1,
      duration: 0.5,
      ease: 'none'
    }, 0);

    // Stars move subtly
    mainTl.to('.stars-left', {
      y: -15,
      duration: 0.5,
      ease: 'none'
    }, 0);

    mainTl.to('.stars-right', {
      y: -10,
      x: 8,
      duration: 0.5,
      ease: 'none'
    }, 0);

    // Círculo crema izquierdo vuelve a su posición y tamaño normal
    mainTl.to('.circle-bottom-left', {
      y: '0%',
      scale: 1,
      duration: 0.5,
      ease: 'none'
    }, 0);

    // Círculo crema derecho vuelve a su posición normal
    mainTl.to('.circle-bottom-right', {
      y: '0%',
      x: '0%',
      duration: 0.5,
      ease: 'none'
    }, 0);

    // Scroll indicator fades out gradually as user scrolls
    mainTl.to('.scroll-indicator', {
      opacity: 0,
      y: 15,
      duration: 0.35,
      ease: 'none'
    }, 0.05);

    // --- 40% to 70% scroll: X decoration and Description appear ---

    // X decoration before title appears
    mainTl.to('.x-before-title', {
      opacity: 1,
      duration: 0.2,
      ease: 'none'
    }, 0.35);

    // Description fades in
    mainTl.to('.hero-description', {
      opacity: 1,
      y: 0,
      duration: 0.3,
      ease: 'none'
    }, 0.4);

    // X decoration right appears
    mainTl.to('.x-decoration-right', {
      opacity: 1,
      duration: 0.2,
      ease: 'none'
    }, 0.55);

    // ============================================
    // STATE 3: BRAIN STATE (60% to 100% scroll)
    // ============================================
    // - Penguin shrinks and moves to top center
    // - All text and decorations fade out
    // - Brain diagram fades in
    // - Section label fades out

    // --- 60% to 80%: Fade out texts and decorations ---

    // Title fades out
    mainTl.to('.hero-title', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    // Description fades out
    mainTl.to('.hero-description', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    // X decorations fade out
    mainTl.to('.x-before-title', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    mainTl.to('.x-decoration-right', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    // Stars fade out
    mainTl.to('.stars-left', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    mainTl.to('.stars-right', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    // Cream circles fade out
    mainTl.to('.circle-bottom-left', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    mainTl.to('.circle-bottom-right', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    // Pink circle fades out
    mainTl.to('.penguin-bg-circle', {
      opacity: 0,
      duration: 0.15,
      ease: 'none'
    }, 0.6);

    // --- 65% to 85%: Penguin shrinks and moves to top ---

    mainTl.to('.penguin-wrapper', {
      top: '8%',
      scale: 0.45,
      duration: 0.25,
      ease: 'none'
    }, 0.65);

    // --- 70% to 100%: Brain appears ---

    mainTl.to('.brain-container', {
      opacity: 1,
      scale: 1,
      duration: 0.25,
      ease: 'none'
    }, 0.7);

    // Brain decorations appear
    mainTl.to('.brain-plus-left', {
      opacity: 1,
      duration: 0.15,
      ease: 'none'
    }, 0.8);

    mainTl.to('.brain-x-right', {
      opacity: 1,
      duration: 0.15,
      ease: 'none'
    }, 0.85);

  } else {
    // Reduced motion: show final state (brain state)
    gsap.set('.hero-title', { opacity: 0 });
    gsap.set('.penguin-wrapper', { scale: 0.45, top: '8%' });
    gsap.set('.penguin-bg-circle', { opacity: 0 });
    gsap.set('.x-before-title', { opacity: 0 });
    gsap.set('.hero-description', { opacity: 0 });
    gsap.set('.x-decoration-right', { opacity: 0 });
    gsap.set('.scroll-indicator', { opacity: 0 });
    gsap.set('.stars-left', { opacity: 0 });
    gsap.set('.stars-right', { opacity: 0 });
    gsap.set('.circle-bottom-left', { opacity: 0 });
    gsap.set('.circle-bottom-right', { opacity: 0 });
    gsap.set('.brain-container', { opacity: 1, scale: 1 });
    gsap.set('.brain-plus-left', { opacity: 1 });
    gsap.set('.brain-x-right', { opacity: 1 });
  }
</script>

<style>
  .star-float {
    animation: float 3s ease-in-out infinite;
  }

  .star-float-delay {
    animation: float 3s ease-in-out infinite;
    animation-delay: 1s;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  /* Performance optimizations */
  .penguin-wrapper,
  .penguin-bg-circle,
  .hero-title {
    will-change: transform, opacity, left, top;
  }

  .hero-description,
  .x-before-title,
  .x-decoration-right,
  .scroll-indicator {
    will-change: opacity, transform;
  }

  .circle-bottom-left,
  .circle-bottom-right,
  .stars-left,
  .stars-right {
    will-change: transform, opacity;
  }

  .brain-container,
  .brain-plus-left,
  .brain-x-right {
    will-change: opacity, transform;
  }

  @media (prefers-reduced-motion: reduce) {
    .star-float,
    .star-float-delay {
      animation: none;
    }

    .penguin-wrapper,
    .penguin-bg-circle,
    .hero-title,
    .hero-description,
    .x-before-title,
    .x-decoration-right,
    .scroll-indicator,
    .circle-bottom-left,
    .circle-bottom-right,
    .stars-left,
    .stars-right,
    .brain-container,
    .brain-plus-left,
    .brain-x-right {
      will-change: auto;
    }
  }
</style>

